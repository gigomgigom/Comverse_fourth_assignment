<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.comverse.fourthsubject.dao.RoleDao">
	<insert id="insertRole" parameterType="roleDto" useGeneratedKeys="true" keyProperty="roleId">
		insert into role 	(
								role_name,
								role_enabled,
								role_removable,
								reg_date
							)
		values				(
								#{roleName},
								#{roleEnabled},
								#{roleRemovable},
								now()
							)
	</insert>
	<insert id="insertRoleMenuAuth">
		insert into role_authority	(
										role_id,
										menu_id
									)
		values						(
										#{roleId},
										#{menuId}
									)
	</insert>
	<insert id="insertRoleBoardAuth">
		insert into admin_board		(
										role_id,
										ctg_id
									)
		values						(
										#{roleId},
										#{ctgId}
									)
	</insert>
	<select id="selectRoleCnt" parameterType="searchIndex">
		select	count(role_id)
		from	role
		<where>
			<if test='keyword != null and !keyword.equals("")'>
				and role_name like concat('%', #{keyword} ,'%')
			</if>
			<if test='stts != 0'>
				<if test='stts == 1'>
					and role_enabled = 1	
				</if>
				<if test='stts == 2'>
					and role_enabled = 0
				</if>
			</if>
		</where>
	</select>
	<select id="selectRoleList" parameterType="searchIndex" resultType="roleDto">
		select	role_id, role_name, role_enabled, reg_date
		from	role
		<where>
			<if test='keyword != null and !keyword.equals("")'>
				and role_name like concat('%', #{keyword} ,'%')
			</if>
			<if test='stts != 0'>
				<if test='stts == 1'>
					and role_enabled = 1	
				</if>
				<if test='stts == 2'>
					and role_enabled = 0
				</if>
			</if>
		</where>
		limit	#{pager.startRowIndex}, #{pager.rowsPerPage}
	</select>
	<select id="selectRoleDetailById">
		select	*
		from	role
		where	role_id = #{detailId}
	</select>
	<select id="selectMenuListByRoleId">
		select	menu_id
		from	role_authority
		where	role_id = #{detailId}
	</select>
	<select id="selectBoardListByRoleId">
		select	ctg_id
		from	admin_board
		where	role_id = #{detailId}
	</select>
	<update id="updateRoleDetail" parameterType="roleDto">
		update	role
		set		role_name = #{roleName},
				role_enabled = #{roleEnabled},
				role_removable = #{roleRemovable}
		where	role_id = #{roleId}
	</update>
	<delete id="deleteRoleBoardList">
		delete from	admin_board
		where		role_id = #{roleId}
	</delete>
	<delete id="deleteRoleMenuList">
		delete from	role_authority
		where		role_id = #{roleId}
	</delete>
	<update id="updateLoginDate">
		update	admin
		set		login_date = now()
		where	adm_id = #{name}
	</update>
	<select id="selectRoleListForManager" resultType="roleDto">
		select	role_id,
				role_name
		from	role
		where	role_enabled = 1
	</select>
	<select id="selectTeamListForManager" resultType="teamDto">
		select	*
		from	team
	</select>
	<select id="selectIsLineExist">
		select	count(adm_no)
		from	admin
		<where>
			<if test="ctg == 1">
				adm_id = #{line}
			</if>
			<if test="ctg == 2">
				adm_email = #{line}
			</if>
		</where>
	</select>
	<insert id="insertAdmin" parameterType="admin" useGeneratedKeys="true" keyProperty="admNo">
		insert into	admin	(
								adm_name,
								adm_id,
								adm_pw,
								adm_tel,
								adm_email,
								adm_stts,
								reg_date,
								adm_enabled,
								adm_team
							)
		values				(
								#{admName},
								#{admId},
								#{admPw},
								#{admTel},
								#{admEmail},
								#{admStts},
								now(),
								#{admEnabled},
								#{admTeam}								
							)
	</insert>
	<insert id="insertAdminRole">
		insert into admin_role	(
									adm_id,
									role_id
								)
		values					(
									#{admNo},
									#{roleId}
								)
	</insert>
	<select id="selectManagerCnt" parameterType="searchIndex">
		select	count(adm_no)
		from	admin
		<where>
			<if test="team != -1">
				and adm_team = #{team}
			</if>
			<if test="keyword != null and !keyword.equals('')">
				<if test="keywordCtg == 1">
					and adm_name like concat('%', #{keyword} , '%')
				</if>
				<if test="keywordCtg == 2">
					and adm_id like concat('%', #{keyword} , '%')
				</if>
				<if test="keywordCtg == 3">
					and adm_tel like concat('%', #{keyword} , '%')
				</if>
				<if test="keywordCtg == 4">
					and adm_email like concat('%', #{keyword} , '%')
				</if>
			</if>
			<if test="stts != 0">
				<if test="stts == 1">
					and adm_stts = '승인완료';
				</if>
				<if test="stts == 2">
					and adm_stts = '승인중';
				</if>
				<if test="stts == 3">
					and adm_stts = '접근불가';
				</if>
				<if test="stts == 4">
					and adm_stts = '휴면';
				</if>
			</if>
		</where>
	</select>
	<select id="selectAdminList" parameterType="searchIndex" resultType="admin">
		select	adm_no,
				adm_name,
				adm_id,
				adm_stts,
				adm_team,
				reg_date,
				login_date
		from	admin
		<where>
			<if test="team != -1">
				and adm_team = #{team}
			</if>
			<if test="keyword != null and !keyword.equals('')">
				<if test="keywordCtg == 1">
					and adm_name like concat('%', #{keyword} , '%')
				</if>
				<if test="keywordCtg == 2">
					and adm_id like concat('%', #{keyword} , '%')
				</if>
				<if test="keywordCtg == 3">
					and adm_tel like concat('%', #{keyword} , '%')
				</if>
				<if test="keywordCtg == 4">
					and adm_email like concat('%', #{keyword} , '%')
				</if>
			</if>
			<if test="stts != 0">
				<if test="stts == 1">
					and adm_stts = '승인완료'
				</if>
				<if test="stts == 2">
					and adm_stts = '승인중'
				</if>
				<if test="stts == 3">
					and adm_stts = '접근불가'
				</if>
				<if test="stts == 4">
					and adm_stts = '휴면'
				</if>
			</if>
		</where>
		limit	#{pager.startRowIndex}, #{pager.rowsPerPage}
	</select>
	<select id="selectTeamByTeamId">
		select	*
		from	team
		where	team_id = #{admTeam}
	</select>
</mapper>